import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { verifyPassword } from '@/utils/password';

export async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { email, password } = body;\n\n    if (!email || !password) {\n      return NextResponse.json(\n        { error: 'Email and password are required' },\n        { status: 400 }\n      );\n    }\n\n    // Find user by email (across all tenants)\n    const user = await prisma.user.findFirst({\n      where: { email },\n      include: { tenant: true },\n    });\n\n    if (!user || !user.passwordHash) {\n      return NextResponse.json(\n        { error: 'Invalid email or password' },\n        { status: 401 }\n      );\n    }\n\n    // Verify password\n    const isValid = await verifyPassword(password, user.passwordHash);\n    if (!isValid) {\n      return NextResponse.json(\n        { error: 'Invalid email or password' },\n        { status: 401 }\n      );\n    }\n\n    // TODO: Create session/auth tokens\n    return NextResponse.json(\n      { tenantSlug: user.tenant.slug, userId: user.id },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Login error:', error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Login failed' },\n      { status: 500 }\n    );\n  }\n}
